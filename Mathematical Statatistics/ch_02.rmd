---
title: ''
mainfont: Arial
fontsize: 12pt
documentclass: report
header-includes:
- \PassOptionsToPackage{table}{xcolor}
- \usepackage{caption}
- \usepackage{amssymb}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage[table]{xcolor}
- \usepackage{fancyhdr}
- \usepackage{boldline}
- \usepackage{tipa}
   \definecolor{headergrey}{HTML}{545454}
   \definecolor{msdblue}{HTML}{1C93D1}
   \pagestyle{fancy}
   \setlength\headheight{30pt}
   \rhead{\color{headergrey}\today}
   \fancyhead[L]{\color{headergrey}Moretz, Brandon}
   \fancyhead[C]{\Large\bfseries\color{headergrey}Exploratory Data Analysis}
   \rfoot{\color{headergrey}Chapter 2}
   \lfoot{\color{headergrey}}
   \fancyfoot[C]{\rmfamily\color{headergrey}Mathematical Statistics}
geometry: left = 1cm, right = 1cm, top = 2cm, bottom = 3cm
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    fig_caption: yes
    latex_engine: xelatex
editor_options: 
  chunk_output_type: console
---


```{r knitr_setup, include = FALSE}

# DO NOT ADD OR REVISE CODE HERE
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, dev = 'png')
options(knitr.table.format = "latex")

```

```{r report_setup, message = FALSE, warning = FALSE, include = FALSE}

library(data.table, quietly = TRUE, warn.conflicts = FALSE)

assignInNamespace("cedta.pkgEvalsUserCode", c(data.table:::cedta.pkgEvalsUserCode, "rtvs"), "data.table")

library(ggplot2, quietly = TRUE, warn.conflicts = FALSE)
library(ggrepel, quietly = TRUE, warn.conflicts = FALSE)
library(ggthemes, quietly = TRUE, warn.conflicts = FALSE)
library(knitr, quietly = TRUE, warn.conflicts = FALSE)
library(kableExtra, quietly = TRUE, warn.conflicts = FALSE)
library(Rblpapi, quietly = TRUE, warn.conflicts = FALSE)
library(scales, quietly = TRUE, warn.conflicts = FALSE)
library(pander, quietly = TRUE, warn.conflicts = FALSE)
library(dplyr, quietly = TRUE, warn.conflicts = FALSE)
library(formattable, quietly = TRUE, warn.conflicts = FALSE)
library(grid, quietly = TRUE, warn.conflicts = FALSE)
library(gridExtra, quietly = TRUE, warn.conflicts = FALSE)
library(png, quietly = TRUE, warn.conflicts = FALSE)
library(extrafont, quietly = TRUE, warn.conflicts = FALSE)
library(tinytex, quietly = TRUE, warn.conflicts = FALSE)
library(stringr, quietly = TRUE, warn.conflicts = FALSE)
library(lubridate, quietly = TRUE, warn.conflicts = FALSE)
library(reshape2, quietly = TRUE, warn.conflicts = FALSE)
library(ggrepel, quietly = TRUE, warn.conflicts = FALSE)
library(mnormt, quietly = TRUE, warn.conflicts = FALSE)
library(Ecdat, quietly = TRUE, warn.conflicts = FALSE)
library(MASS, quietly = TRUE, warn.conflicts = FALSE)
library(copula, quietly = TRUE, warn.conflicts = FALSE)
library(fGarch, quietly = TRUE, warn.conflicts = FALSE)
library(forecast, quietly = TRUE, warn.conflicts = FALSE)
library(tseries, quietly = TRUE, warn.conflicts = FALSE)
library(gmodels, quietly = TRUE, warn.conflicts = FALSE)
library(rugarch, quietly = TRUE, warn.conflicts = FALSE)

options(tinytex.verbose = TRUE)
suppressMessages(library("tidyverse"))

pretty_kable <- function(data, title, dig = 2) {
  kable(data, caption = title, digits = dig) %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
      kableExtra::kable_styling(latex_options = "hold_position")
}

theme_set(theme_light())

# Theme Overrides
theme_update(axis.text.x = element_text(size = 10),
             axis.text.y = element_text(size = 10),
             plot.title = element_text(hjust = 0.5, size = 16, face = "bold", color = "darkgreen"),
             axis.title = element_text(face = "bold", size = 12, colour = "steelblue4"),
             plot.subtitle = element_text(face = "bold", size = 8, colour = "darkred"),
             legend.title = element_text(size = 12, color = "darkred", face = "bold"),
             legend.position = "right", legend.title.align=0.5,
             panel.border = element_rect(linetype = "solid", 
                                         colour = "lightgray"), 
             plot.margin = unit(c( 0.1, 0.1, 0.1, 0.1), "inches"))

data.dir <- "D:/Projects/Statistical-Computing/datasets/"

```

```{r pander_setup, include = FALSE}

knitr::opts_chunk$set(comment = NA)

panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)

```

#### Chapter 2

### 2.1

Compute the mean $\bar{x}$ and median, $m$ ,of the six numbers: 3, 5, 8, 15, 20, 21, 24, then apply the natural log to the data.

```{r, c2_1, echo = T}

x <- c(3, 5, 8, 15, 20, 21, 24)
xt <- log(x)

```

Does $\bar{x}$ = $\tilde{x}$ ?

```{r echo = T}

log(mean(x)) == mean(xt)

```

Does $m$ = $\tilde{m}$ ?

```{r echo = T}

log(median(x)) == median(xt)

```

### 2.2

Compute the median $\bar{x}$ and median of the eight numbers: 1, 2, 4, 5, 6, 8, 11, 15.

Let $f(x) = \sqrt{x}$

Apply the transformation, then compute the mean, $tilde{x}$ and median, m, of the transformed data.

```{r echo = T}

x <- c(1, 2, 4, 5, 6, 8, 11, 15)
xt <- sqrt(x)
   
```

+ Is $f(\bar{x}) = \tilde{x}$?

```{r echo = T}

sqrt(mean(x)) == mean(xt)

```

+ Is $f(m) = \tilde{m}$?

```{r echo = T}

sqrt(median(x)) == median(xt)

```

### 2.4

Import the flights data.

```{r echo = T}

flights <- data.table(read.csv(paste0(data.dir, "FlightDelays.csv"),
                 header = T))

```

a.) Create a table and bar chart of the departure times _(DepartTimes)_

```{r echo = T}

table(flights$DepartTime)

```

```{r echo = T, fig.height=3.5}

ggplot(flights, aes(DepartTime)) +
   geom_bar(aes(fill = ..count..)) +
   labs(title = "Depart Times")

```

\newpage

b.) Create a contingency table of the variables _Day_ and _Delay30_.

```{r echo = T}

delay <- table(flights$Day, flights$Delayed30)

pretty_kable(delay, "Flight Delays")

```

Show the proportions of delayed flights, by day:

```{r echo = T}

pretty_kable(round(prop.table(delay), 4) * 100, "Flight Delays Proportions")

```

\newpage

c.) Create side-by-side boxplots of the lengths of flight times, grouped by wether or not the flight was delayed at least 30 minutes:

```{r echo = T, fig.height=3.5}

ggplot(flights) +
   geom_boxplot(aes(Delayed30, FlightLength, fill = Delayed30)) +
   labs(title = "Flight Length by Delayed30")
  
```

d.) Do you think there is a relationship between the length of the flight and whether or not the departure time is delayed by at least 30 minutes?

The average flight time is the same, however, the flights that are delayed 30 minutes or more seem to be shorter overall.

### 2.5

Import the General Social Survey data.

```{r echo = T}

gss <- data.table(read.csv(paste0(data.dir, "GSS2002.csv"),
                 header = T))

```

a.) Create a table and a bar chart of the response to the question about the death penalty.

```{r echo = T}

table(gss$DeathPenalty)

```

```{r echo = T, fig.height=3.5}

ggplot(gss, aes(DeathPenalty)) +
   geom_bar(aes(fill = ..count..)) +
   labs(title = "Death Penalty Survey Results")

```

b.) Use the _table_ command and the summary command in R on the gun ownership variable. What additional information does the summary command give that the table does not?

```{r echo = T}

table(gss$OwnGun)

```

```{r echo = T}

summary(gss$OwnGun)

```

The summary tells us how many people didn't respond at all to the question.

c.) Create a contingency table displaying the relationship between opinions about the death penalty to that about gun ownership.

```{r echo = T}

with(gss, {
   table(OwnGun, DeathPenalty)
})

```

d.) What proportion of gun owners favor the death penalty? Does it appear to be different from the proportion among those who do not own guns?

```{r echo = T}

round(prop.table(with(gss, {
   table(OwnGun, DeathPenalty)
})) * 100, 2)

```

It does seem that gun owners are overwhelmingly in favor of the death penalty compared to those who do not own a gun.


### 2.6

Import the data from the recidivism case study in section 1.4.

Import the General Social Survey data.

```{r echo = T}

recid <- data.table(read.csv(paste0(data.dir, "Recidivism.csv"),
                 header = T))

```

a.) Create a table and bar chart  of the __Recid__ variable.

```{r echo = T}
table(recid$Recid)
```

```{r echo = T}
ggplot(recid, aes(Recid)) +
   geom_bar(aes(fill = ..count..)) +
   labs(title = "Recidivism")
```

b.) Create a contingency table summarizing the relationship between recidivism (__Recid__) by age (__Age25__).

```{r echo = T}
with(recid, {
   table(Recid, Age25)
})
```

Of those over 25 years of age, what proportion were sent back to prision?

```{r echo = T}
round(prop.table(with(recid, {
   table(Recid, Age25)
})) * 100, 2)
```

c.) Create side-by-side boxplots of the number of days to recidivism grouped by type of violation, and give three comparative statements about the distributions.

```{r echo = T, fig.height=3.5}
ggplot(recid[!is.na(Days)], aes(Type, Days)) +
   geom_boxplot(aes(fill = Type)) +
   labs(title = "Days Until Recidivism by Crime Type")

```

+ 1.) Technical violations seem to happen quicker after initial release than new crimes.

+ 2.) There are more outliers present in the technical violations, with a cluster of them occuring after 900 days.

+ 3.) The variance is days until recidivism is larger for new crimes. The chances of a technical violation occuring after 450 days drop dramatically. 

```{r echo = T}
recid[!is.na(Days), .(Variance = comma(var(Days))), by = Type]
```

d.) Use the quantile command to obtain the quartiles of the number of days to recidivism. Since there are missing values (__NA__) for those released offeneders who had not recidivated, you will need to add the argument __na.rm = T__ to the __quartile__ command to exclude those observations.

```{r echo = T}
quantile(recid$Days, na.rm = T)
```
e.) Create ecdf's of days to recidivism for those under 25 years of age and those 25 years of age or older.

```{r echo = T}

with(recid, {
   recid$U25 <- Age25 == "Under 25"
   
   plot.ecdf(recid[U25 == T]$Days)
   plot.ecdf(recid[U25 == F]$Days, col="cornflowerblue", add = T)
})

```

Approximately what proportion in each age group were sent back to prision 400 days after release?

Of those who were sent back to prision,

```{r echo = T}

recid[!is.na(Days), 
      .(Days, O400 = Days >= 400), by = Age25][,
                                               .(Proportion = sum(O400) / .N), by = Age25]

```

went back after being release 400 days or more.